{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<title>Ajustes</title>
<div class="minA">
    <ul class="collapsible popout" data-collapsible="accordion">
        <li>
            <div class="collapsible-header red darken-3"><i class="fa fa-user"></i>Cuenta</div>
            <div class="collapsible-body ">
                <div class="row">
                    <div class="col s6">
                        <form action="{% url 'pikquick:cambiar_pass' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <h4 class="center-align">Cambiar contrase単a</h4>
                            <div class="input-field">
                                <input placeholder="Contrase単a antigua" name="password1" id="id_password1" type="password"  value="">
                            </div>
                            <div class="input-field">
                                <input placeholder="Contrase単a nueva" name="password2" id="id_password2" type="password" value="">
                            </div>
                            <div class="right-align">
                                <button class="card-panel red lighten-1 waves-effect waves-orange btn-large" id="crear" type="submit">
                                    Cambiar contrase単a
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="col s6">
                        <a class="card-panel red lighten-1 waves-effect waves-orange btn-large" href="{% url 'pikquick:salir_usuario' %}">
                            Salir
                        </a>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>
{% for post in posts %}
<div class='section white center'>
    <div class='container' style='background: #f5f5f5;'>
        <div class='container' style='background:#f5f5f5; width:100%'>
            <ul class='collection'>
                <li class='collection-item avatar'>
                    <img src="{% static 'images/perfil.jpg' %}" alt='' class='circle'>
                    <i class='material-icons' style="margin-right:95%">{{post.usuario}}</i>
                    <a class='secondary-content'>
                        <i class='material-icons'>{{post.fecha}}</i>
                    </a>

                    {% if user.is_staff %}
                    <a href=""><i class="fa fa-trash-o" style="margin-right:1%"></i>Eliminar</a>
                    {% endif %}

                </li>
            </ul>
            <div class='row'>
                <div class="col s12 m6">
                    <div class="card">
                        <div class="card-image">
                            <img class='activator' src='{{ MEDIA_URL }}{{post.img1}}' style='width:400px; height:450px; margin-top:4%;'>
                        </div>
                        <div class="card-content">
                            <p>{{post.desc1}}</p>
                        </div>
                        <div class="card-action">
                            <a href="#">Stars</a>
                        </div>
                    </div>
                </div>
                <div class="col s12 m6">
                    <div class="card">
                        <div class="card-image">
                            <img class='activator' src='{{ MEDIA_URL }}{{post.img2}}' style='width:400px; height:450px; margin-top:4%;'>
                        </div>
                        <div class="card-content">
                            <p>{{post.desc2}}</p>
                        </div>
                        <div class="card-action">
                            <a href="#">Stars</a>
                        </div>
                    </div>
                </div>
                <h3>{{post.descPub}}
            </div>
        </div>
    </div>
    {% csrf_token %}
    <input type="button" id="btn_ver_{{post.id}}" value="+"></button>
    <div id="mensajes_{{post.id}}">
        {% include "mensajes.html" %}
    </div>

    <h3>Mensaje:</h3>

    <textarea class="materialize-textarea" sytle=" padding:-200px;" id="message_{{post.id}}" required data-validation-required-message="Please enter a message."></textarea>

    <button class="btn waves-effect waves-light" id="btn_enviar_{{post.id}}" name="enviar"> Comment <i class="fa fa-paper-plane"></i>
 </button>
</div>

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>

    $("#btn_enviar_{{post.id}}").click(function(){
        console.log("VAMO");
        var data={
            csrfmiddlewaretoken: '{{ csrf_token }}',
            id:'{{post.id}}',
            coment_txt:$('#message_{{post.id}}').val(),
        }
        $.ajax({
            type: "POST",
            url: "{% url 'pikquick:save_message' %}",
            data: data,
            success: function(result){
                $("#mensajes_{{post.id}}").html(result);
                $("#message_{{post.id}}").val("");
            },
            error: function(err){
                console.log("ERRRORRRR");
                console.log(err.responseText);
            },
        });
    });

    $("#btn_ver_{{post.id}}").click(function(){

        var boton = document.getElementById("btn_ver_{{post.id}}")
        if (boton.value=="-"){
            document.getElementById('mensajes_{{post.id}}').style.display = 'none';
            boton.setAttribute('value', '+');
            console.log("mostrar");
        }
        else{
            console.log("mostrar");
            var data={
                csrfmiddlewaretoken: '{{ csrf_token }}',
                id:'{{post.id}}',

            }
            $.ajax({
                type: "POST",
                url: "{% url 'pikquick:ver_message' %}",
                data: data,
                success: function(result){
                    $("#mensajes_{{post.id}}").html(result);
                    $("#message_{{post.id}}").val("");
                },
                error: function(err){
                    console.log("ERRRORRRR");
                    console.log(err.responseText);
                },
            });
            boton.setAttribute('value', '-');

            document.getElementById('mensajes_{{post.id}}').style.display = 'block';
        };
        });

</script>
{% endfor %}
{% endblock %}
